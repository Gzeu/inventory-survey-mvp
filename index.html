<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Survey MVP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --success: #16a34a;
            --warning: #ea580c;
            --danger: #dc2626;
            --bg: #f8fafc;
            --bg-dark: #1e293b;
            --text: #0f172a;
            --text-light: #64748b;
            --border: #e2e8f0;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 30px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        header p {
            opacity: 0.9;
            font-size: 14px;
        }

        nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--text);
        }

        .nav-btn:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .nav-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }

        .card h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-box.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        .stat-box.success {
            background: linear-gradient(135deg, var(--success) 0%, #15803d 100%);
        }

        .stat-box.danger {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
        }

        .stat-box h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-box .value {
            font-size: 32px;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #15803d;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background: var(--bg);
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 2px solid var(--border);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        tbody tr:hover {
            background: var(--bg);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: var(--bg);
            color: var(--text);
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.warning {
            background: #fed7aa;
            color: #92400e;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn {
            padding: 6px 12px;
            font-size: 12px;
            margin-right: 6px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background: var(--primary);
            color: var(--white);
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--primary-dark);
        }

        .action-btn.delete {
            background: var(--danger);
        }

        .action-btn.delete:hover {
            background: #b91c1c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--secondary);
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: var(--text);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .search-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-filter input,
        .search-filter select {
            flex: 1;
            min-width: 150px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert.info {
            background: #dbeafe;
            color: #0c4a6e;
            border: 1px solid #bfdbfe;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            opacity: 0.5;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 22px;
            }

            nav {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            .modal-content {
                padding: 20px;
            }

            .card {
                padding: 16px;
            }
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--text-light);
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .low-stock {
            color: var(--danger);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“¦ Inventory Survey MVP</h1>
            <p>Complete inventory management and daily survey collection with real-time analytics</p>
        </header>

        <nav>
            <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showSection('inventory')">Inventory</button>
            <button class="nav-btn" onclick="showSection('survey')">Daily Survey</button>
            <button class="nav-btn" onclick="showSection('analytics')">Analytics</button>
            <button class="nav-btn" onclick="showSection('export')">Export</button>
            <button class="nav-btn btn-secondary" onclick="loadSampleData()" style="background: #fbbf24; color: var(--text); border-color: #fbbf24;">Load Sample Data</button>
            <button class="nav-btn btn-danger" onclick="clearAllData()" style="margin-left: auto;">Clear All Data</button>
        </nav>

        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <div class="grid">
                <div class="stat-box">
                    <h3>Total Items</h3>
                    <div class="value" id="totalItems">0</div>
                </div>
                <div class="stat-box success">
                    <h3>Inventory Value</h3>
                    <div class="value" id="inventoryValue">$0</div>
                </div>
                <div class="stat-box warning">
                    <h3>Low Stock Items</h3>
                    <div class="value" id="lowStockCount">0</div>
                </div>
                <div class="stat-box">
                    <h3>Survey Responses</h3>
                    <div class="value" id="surveyCount">0</div>
                </div>
            </div>

            <div class="card">
                <h2>Recent Activity</h2>
                <div id="recentActivity" style="max-height: 400px; overflow-y: auto;"></div>
            </div>

            <div class="card">
                <h2>Quick Stats</h2>
                <table>
                    <tr>
                        <td>Total Categories:</td>
                        <td id="totalCategories" style="font-weight: bold;">0</td>
                    </tr>
                    <tr>
                        <td>Average Item Price:</td>
                        <td id="avgPrice" style="font-weight: bold;">$0</td>
                    </tr>
                    <tr>
                        <td>Locations Used:</td>
                        <td id="locationsCount" style="font-weight: bold;">0</td>
                    </tr>
                    <tr>
                        <td>Last Survey:</td>
                        <td id="lastSurvey" style="font-weight: bold;">Never</td>
                    </tr>
                </table>
            </div>
        </section>

        <!-- INVENTORY SECTION -->
        <section id="inventory" class="section">
            <div class="card">
                <h2>Inventory Management</h2>
                
                <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="Search by SKU or name..." onkeyup="filterInventory()">
                    <select id="categoryFilter" onchange="filterInventory()">
                        <option value="">All Categories</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Supplies">Supplies</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Other">Other</option>
                    </select>
                    <button class="btn" onclick="openAddItemModal()">+ Add Item</button>
                </div>

                <div id="inventoryTable"></div>
            </div>
        </section>

        <!-- SURVEY SECTION -->
        <section id="survey" class="section">
            <div class="card">
                <h2>Daily Survey</h2>
                <p style="color: var(--text-light); margin-bottom: 20px;">Complete the daily 3-question survey to help us improve our inventory tracking.</p>

                <form id="surveyForm">
                    <div class="form-group">
                        <label>1. How accurate was today's inventory count? (1-5)</label>
                        <select id="q1" required>
                            <option value="">Select rating...</option>
                            <option value="1">1 - Very Inaccurate</option>
                            <option value="2">2 - Somewhat Inaccurate</option>
                            <option value="3">3 - Neutral</option>
                            <option value="4">4 - Somewhat Accurate</option>
                            <option value="5">5 - Very Accurate</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>2. Were there any stock-outs today?</label>
                        <select id="q2" required>
                            <option value="">Select option...</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                            <option value="partial">Partial stock-out</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>3. Overall, how was today's inventory performance? (1-5)</label>
                        <select id="q3" required>
                            <option value="">Select rating...</option>
                            <option value="1">1 - Poor</option>
                            <option value="2">2 - Fair</option>
                            <option value="3">3 - Good</option>
                            <option value="4">4 - Very Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Comments (Optional)</label>
                        <textarea id="comments" placeholder="Add any additional notes or observations..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">Submit Survey</button>
                </form>

                <div id="surveyList" style="margin-top: 40px;"></div>
            </div>
        </section>

        <!-- ANALYTICS SECTION -->
        <section id="analytics" class="section">
            <div class="card">
                <h2>Analytics Dashboard</h2>
                
                <div class="grid" style="margin-bottom: 40px;">
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="surveyTrendChart"></canvas>
                    </div>
                </div>

                <div class="chart-container" style="max-width: 100%; height: 300px;">
                    <canvas id="inventoryValueChart"></canvas>
                </div>

                <div id="analyticsSummary" style="margin-top: 30px;"></div>
            </div>
        </section>

        <!-- EXPORT SECTION -->
        <section id="export" class="section">
            <div class="card">
                <h2>Export Data</h2>
                
                <div class="form-group">
                    <label>Select Date Range</label>
                    <div class="form-row">
                        <div>
                            <label style="font-size: 12px;">From Date</label>
                            <input type="date" id="exportFromDate">
                        </div>
                        <div>
                            <label style="font-size: 12px;">To Date</label>
                            <input type="date" id="exportToDate">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Select Data to Export</label>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="exportInventory" checked> Inventory Items
                        </label>
                        <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="exportSurveys" checked> Survey Responses
                        </label>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn" onclick="exportToCSV()">ðŸ“„ Export to CSV</button>
                    <button class="btn" onclick="exportToExcel()">ðŸ“Š Export to Excel</button>
                    <button class="btn" onclick="exportToPDF()">ðŸ“‹ Export to PDF</button>
                    <button class="btn btn-secondary" onclick="exportToJSON()">{ } Export to JSON</button>
                </div>

                <div id="exportPreview" style="margin-top: 30px;"></div>
            </div>
        </section>
    </div>

    <!-- ADD ITEM MODAL -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Inventory Item</h3>
                <button class="close-btn" onclick="closeModal('addItemModal')">&times;</button>
            </div>
            
            <form id="addItemForm">
                <div class="form-group">
                    <label>SKU *</label>
                    <input type="text" id="itemSku" required placeholder="e.g., SKU-001">
                </div>

                <div class="form-group">
                    <label>Product Name *</label>
                    <input type="text" id="itemName" required placeholder="e.g., Laptop">
                </div>

                <div class="form-group">
                    <label>Category *</label>
                    <select id="itemCategory" required>
                        <option value="">Select category...</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Supplies">Supplies</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Quantity *</label>
                    <input type="number" id="itemQuantity" required min="0" placeholder="0">
                </div>

                <div class="form-group">
                    <label>Unit Price *</label>
                    <input type="number" id="itemPrice" required min="0" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" id="itemLocation" required placeholder="e.g., Shelf A1">
                </div>

                <div class="form-group">
                    <label>Reorder Level</label>
                    <input type="number" id="itemReorderLevel" min="0" placeholder="0">
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="itemNotes" placeholder="Add any notes..."></textarea>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Add Item</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addItemModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- EDIT ITEM MODAL -->
    <div id="editItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Inventory Item</h3>
                <button class="close-btn" onclick="closeModal('editItemModal')">&times;</button>
            </div>
            
            <form id="editItemForm">
                <input type="hidden" id="editItemId">

                <div class="form-group">
                    <label>SKU *</label>
                    <input type="text" id="editItemSku" required>
                </div>

                <div class="form-group">
                    <label>Product Name *</label>
                    <input type="text" id="editItemName" required>
                </div>

                <div class="form-group">
                    <label>Category *</label>
                    <select id="editItemCategory" required>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Supplies">Supplies</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Quantity *</label>
                    <input type="number" id="editItemQuantity" required min="0">
                </div>

                <div class="form-group">
                    <label>Unit Price *</label>
                    <input type="number" id="editItemPrice" required min="0" step="0.01">
                </div>

                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" id="editItemLocation" required>
                </div>

                <div class="form-group">
                    <label>Reorder Level</label>
                    <input type="number" id="editItemReorderLevel" min="0">
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="editItemNotes"></textarea>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Update Item</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editItemModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============== DATA MANAGEMENT ==============
        const DB = {
            inventory: [],
            surveys: [],
            activities: []
        };

        // Initialize from localStorage
        function initializeDB() {
            const saved = localStorage.getItem('inventorySurveyDB');
            if (saved) {
                Object.assign(DB, JSON.parse(saved));
            }
        }

        // Save to localStorage
        function saveDB() {
            localStorage.setItem('inventorySurveyDB', JSON.stringify(DB));
            updateDashboard();
            showAlert('Data saved successfully!', 'success');
        }

        // Add activity log
        function addActivity(message, type = 'info') {
            DB.activities.unshift({
                message,
                type,
                timestamp: new Date().toLocaleString()
            });
            if (DB.activities.length > 50) {
                DB.activities.pop();
            }
        }

        // ============== UI FUNCTIONS ==============
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (sectionId === 'analytics') {
                setTimeout(renderAnalytics, 100);
            } else if (sectionId === 'inventory') {
                renderInventoryTable();
            } else if (sectionId === 'survey') {
                renderSurveyList();
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 4000);
        }

        // ============== INVENTORY FUNCTIONS ==============
        function openAddItemModal() {
            document.getElementById('addItemForm').reset();
            openModal('addItemModal');
        }

        function openEditItemModal(id) {
            const item = DB.inventory.find(i => i.id === id);
            if (!item) return;

            document.getElementById('editItemId').value = id;
            document.getElementById('editItemSku').value = item.sku;
            document.getElementById('editItemName').value = item.name;
            document.getElementById('editItemCategory').value = item.category;
            document.getElementById('editItemQuantity').value = item.quantity;
            document.getElementById('editItemPrice').value = item.price;
            document.getElementById('editItemLocation').value = item.location;
            document.getElementById('editItemReorderLevel').value = item.reorderLevel || 0;
            document.getElementById('editItemNotes').value = item.notes || '';

            openModal('editItemModal');
        }

        function deleteItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                const item = DB.inventory.find(i => i.id === id);
                DB.inventory = DB.inventory.filter(i => i.id !== id);
                addActivity(`Deleted item: ${item.name} (${item.sku})`, 'warning');
                saveDB();
                renderInventoryTable();
                showAlert('Item deleted successfully!', 'success');
            }
        }

        document.getElementById('addItemForm')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const newItem = {
                id: Date.now(),
                sku: document.getElementById('itemSku').value,
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                quantity: parseInt(document.getElementById('itemQuantity').value),
                price: parseFloat(document.getElementById('itemPrice').value),
                location: document.getElementById('itemLocation').value,
                reorderLevel: parseInt(document.getElementById('itemReorderLevel').value) || 0,
                notes: document.getElementById('itemNotes').value,
                createdAt: new Date().toISOString()
            };

            DB.inventory.push(newItem);
            addActivity(`Added item: ${newItem.name} (${newItem.sku})`, 'info');
            saveDB();
            closeModal('addItemModal');
            renderInventoryTable();
            showAlert(`Item "${newItem.name}" added successfully!`, 'success');
        });

        document.getElementById('editItemForm')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const id = parseInt(document.getElementById('editItemId').value);
            const itemIndex = DB.inventory.findIndex(i => i.id === id);
            
            if (itemIndex !== -1) {
                DB.inventory[itemIndex] = {
                    ...DB.inventory[itemIndex],
                    sku: document.getElementById('editItemSku').value,
                    name: document.getElementById('editItemName').value,
                    category: document.getElementById('editItemCategory').value,
                    quantity: parseInt(document.getElementById('editItemQuantity').value),
                    price: parseFloat(document.getElementById('editItemPrice').value),
                    location: document.getElementById('editItemLocation').value,
                    reorderLevel: parseInt(document.getElementById('editItemReorderLevel').value) || 0,
                    notes: document.getElementById('editItemNotes').value
                };

                addActivity(`Updated item: ${DB.inventory[itemIndex].name}`, 'info');
                saveDB();
                closeModal('editItemModal');
                renderInventoryTable();
                showAlert('Item updated successfully!', 'success');
            }
        });

        function renderInventoryTable() {
            const container = document.getElementById('inventoryTable');
            if (DB.inventory.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No inventory items. Click "Add Item" to get started.</p></div>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Value</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            DB.inventory.forEach(item => {
                const value = (item.quantity * item.price).toFixed(2);
                const isLowStock = item.reorderLevel > 0 && item.quantity <= item.reorderLevel;
                const statusBadge = isLowStock 
                    ? `<span class="badge danger">Low Stock</span>` 
                    : `<span class="badge success">OK</span>`;

                html += `
                    <tr>
                        <td><strong>${item.sku}</strong></td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${isLowStock ? `<span class="low-stock">${item.quantity}</span>` : item.quantity}</td>
                        <td>$${item.price.toFixed(2)}</td>
                        <td>$${value}</td>
                        <td>${item.location}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="action-btn" onclick="openEditItemModal(${item.id})">Edit</button>
                            <button class="action-btn delete" onclick="deleteItem(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function filterInventory() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;

            const filtered = DB.inventory.filter(item => {
                const matchesSearch = item.sku.toLowerCase().includes(searchText) || 
                                     item.name.toLowerCase().includes(searchText);
                const matchesCategory = !category || item.category === category;
                return matchesSearch && matchesCategory;
            });

            document.getElementById('inventoryTable').innerHTML = filtered.length === 0
                ? '<div class="empty-state"><p>No items match your search.</p></div>'
                : renderFilteredTable(filtered);
        }

        function renderFilteredTable(items) {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Value</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            items.forEach(item => {
                const value = (item.quantity * item.price).toFixed(2);
                const isLowStock = item.reorderLevel > 0 && item.quantity <= item.reorderLevel;
                const statusBadge = isLowStock 
                    ? `<span class="badge danger">Low Stock</span>` 
                    : `<span class="badge success">OK</span>`;

                html += `
                    <tr>
                        <td><strong>${item.sku}</strong></td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>${isLowStock ? `<span class="low-stock">${item.quantity}</span>` : item.quantity}</td>
                        <td>$${item.price.toFixed(2)}</td>
                        <td>$${value}</td>
                        <td>${item.location}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="action-btn" onclick="openEditItemModal(${item.id})">Edit</button>
                            <button class="action-btn delete" onclick="deleteItem(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        // ============== SURVEY FUNCTIONS ==============
        document.getElementById('surveyForm')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const survey = {
                id: Date.now(),
                q1: document.getElementById('q1').value,
                q2: document.getElementById('q2').value,
                q3: document.getElementById('q3').value,
                comments: document.getElementById('comments').value,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };

            DB.surveys.push(survey);
            addActivity('New survey response submitted', 'success');
            saveDB();
            this.reset();
            renderSurveyList();
            showAlert('Survey submitted successfully!', 'success');
        });

        function renderSurveyList() {
            const container = document.getElementById('surveyList');
            if (DB.surveys.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No survey responses yet. Complete the survey above!</p></div>';
                return;
            }

            let html = '<h3>Recent Survey Responses</h3><table><thead><tr><th>Date</th><th>Q1 (Accuracy)</th><th>Q2 (Stock-outs)</th><th>Q3 (Performance)</th><th>Comments</th></tr></thead><tbody>';

            DB.surveys.slice().reverse().slice(0, 20).forEach(survey => {
                html += `
                    <tr>
                        <td>${new Date(survey.timestamp).toLocaleString()}</td>
                        <td>${survey.q1}/5</td>
                        <td>${survey.q2}</td>
                        <td>${survey.q3}/5</td>
                        <td>${survey.comments || '-'}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ============== ANALYTICS FUNCTIONS ==============
        function renderAnalytics() {
            renderCategoryChart();
            renderSurveyTrendChart();
            renderInventoryValueChart();
            renderAnalyticsSummary();
        }

        function renderCategoryChart() {
            const categories = {};
            DB.inventory.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + item.quantity;
            });

            const ctx = document.getElementById('categoryChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: ['#2563eb', '#16a34a', '#ea580c', '#dc2626', '#8b5cf6'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Inventory by Category' }
                    }
                }
            });
        }

        function renderSurveyTrendChart() {
            const dates = {};
            DB.surveys.forEach(survey => {
                const date = survey.date;
                dates[date] = dates[date] || [];
                dates[date].push(parseInt(survey.q1));
            });

            const avgByDate = Object.keys(dates).sort().map(date => ({
                date,
                avg: (dates[date].reduce((a, b) => a + b, 0) / dates[date].length).toFixed(1)
            }));

            const ctx = document.getElementById('surveyTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: avgByDate.map(d => d.date),
                    datasets: [{
                        label: 'Avg Accuracy Rating',
                        data: avgByDate.map(d => d.avg),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: { display: true, text: 'Survey Accuracy Trend' }
                    },
                    scales: {
                        y: { min: 0, max: 5 }
                    }
                }
            });
        }

        function renderInventoryValueChart() {
            const values = DB.inventory.map(item => ({
                name: item.name,
                value: item.quantity * item.price
            })).sort((a, b) => b.value - a.value).slice(0, 10);

            const ctx = document.getElementById('inventoryValueChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: values.map(v => v.name),
                    datasets: [{
                        label: 'Inventory Value ($)',
                        data: values.map(v => v.value),
                        backgroundColor: '#16a34a',
                        borderColor: '#15803d',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: { display: true, text: 'Top 10 Items by Value' }
                    }
                }
            });
        }

        function renderAnalyticsSummary() {
            const total = DB.inventory.reduce((sum, i) => sum + (i.quantity * i.price), 0);
            const avgSurveyRating = DB.surveys.length > 0
                ? (DB.surveys.reduce((sum, s) => sum + parseInt(s.q1), 0) / DB.surveys.length).toFixed(1)
                : 'N/A';

            const html = `
                <div class="grid">
                    <div style="background: var(--bg); padding: 20px; border-radius: 8px;">
                        <h4>Total Inventory Value</h4>
                        <p style="font-size: 24px; font-weight: bold; color: var(--primary);">$${total.toFixed(2)}</p>
                    </div>
                    <div style="background: var(--bg); padding: 20px; border-radius: 8px;">
                        <h4>Avg Survey Accuracy</h4>
                        <p style="font-size: 24px; font-weight: bold; color: var(--success);">${avgSurveyRating}/5</p>
                    </div>
                    <div style="background: var(--bg); padding: 20px; border-radius: 8px;">
                        <h4>Total Survey Responses</h4>
                        <p style="font-size: 24px; font-weight: bold; color: var(--primary);">${DB.surveys.length}</p>
                    </div>
                </div>
            `;

            document.getElementById('analyticsSummary').innerHTML = html;
        }

        // ============== EXPORT FUNCTIONS ==============
        function getExportData() {
            const fromDate = document.getElementById('exportFromDate').value ? new Date(document.getElementById('exportFromDate').value) : null;
            const toDate = document.getElementById('exportToDate').value ? new Date(document.getElementById('exportToDate').value) : null;

            let data = {};

            if (document.getElementById('exportInventory').checked) {
                data.inventory = DB.inventory;
            }

            if (document.getElementById('exportSurveys').checked) {
                data.surveys = DB.surveys.filter(s => {
                    const surveyDate = new Date(s.timestamp);
                    if (fromDate && surveyDate < fromDate) return false;
                    if (toDate && surveyDate > toDate) return false;
                    return true;
                });
            }

            return data;
        }

        function exportToCSV() {
            const data = getExportData();
            let csv = '';

            if (data.inventory && data.inventory.length > 0) {
                csv += 'INVENTORY ITEMS\n';
                csv += 'SKU,Name,Category,Quantity,Price,Value,Location,Notes\n';
                data.inventory.forEach(item => {
                    const value = item.quantity * item.price;
                    csv += `"${item.sku}","${item.name}","${item.category}",${item.quantity},${item.price},${value},"${item.location}","${(item.notes || '').replace(/"/g, '""')}"\n`;
                });
                csv += '\n\n';
            }

            if (data.surveys && data.surveys.length > 0) {
                csv += 'SURVEY RESPONSES\n';
                csv += 'Date,Accuracy (Q1),Stock-outs (Q2),Performance (Q3),Comments\n';
                data.surveys.forEach(survey => {
                    csv += `"${survey.date}","${survey.q1}","${survey.q2}","${survey.q3}","${(survey.comments || '').replace(/"/g, '""')}"\n`;
                });
            }

            downloadFile(csv, 'inventory-survey-export.csv', 'text/csv');
            showAlert('Data exported to CSV successfully!', 'success');
        }

        function exportToExcel() {
            const data = getExportData();
            const wb = XLSX.utils.book_new();

            if (data.inventory && data.inventory.length > 0) {
                const inventoryData = data.inventory.map(item => ({
                    SKU: item.sku,
                    Name: item.name,
                    Category: item.category,
                    Quantity: item.quantity,
                    Price: item.price,
                    Value: item.quantity * item.price,
                    Location: item.location,
                    'Reorder Level': item.reorderLevel,
                    Notes: item.notes
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(inventoryData), 'Inventory');
            }

            if (data.surveys && data.surveys.length > 0) {
                const surveyData = data.surveys.map(survey => ({
                    Date: survey.date,
                    'Accuracy (Q1)': survey.q1,
                    'Stock-outs (Q2)': survey.q2,
                    'Performance (Q3)': survey.q3,
                    Comments: survey.comments
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(surveyData), 'Surveys');
            }

            XLSX.writeFile(wb, 'inventory-survey-export.xlsx');
            showAlert('Data exported to Excel successfully!', 'success');
        }

        function exportToPDF() {
            const data = getExportData();
            const element = document.createElement('div');
            element.style.padding = '20px';

            let html = '<h1>Inventory & Survey Report</h1>';
            html += `<p>Generated: ${new Date().toLocaleString()}</p>`;

            if (data.inventory && data.inventory.length > 0) {
                html += '<h2>Inventory Items</h2>';
                html += '<table style="width: 100%; border-collapse: collapse;"><thead>';
                html += '<tr><th style="border: 1px solid #ddd; padding: 8px;">SKU</th><th style="border: 1px solid #ddd; padding: 8px;">Name</th><th style="border: 1px solid #ddd; padding: 8px;">Category</th><th style="border: 1px solid #ddd; padding: 8px;">Qty</th><th style="border: 1px solid #ddd; padding: 8px;">Price</th><th style="border: 1px solid #ddd; padding: 8px;">Value</th></tr>';
                html += '</thead><tbody>';
                data.inventory.forEach(item => {
                    html += `<tr><td style="border: 1px solid #ddd; padding: 8px;">${item.sku}</td><td style="border: 1px solid #ddd; padding: 8px;">${item.name}</td><td style="border: 1px solid #ddd; padding: 8px;">${item.category}</td><td style="border: 1px solid #ddd; padding: 8px;">${item.quantity}</td><td style="border: 1px solid #ddd; padding: 8px;">$${item.price}</td><td style="border: 1px solid #ddd; padding: 8px;">$${(item.quantity * item.price).toFixed(2)}</td></tr>`;
                });
                html += '</tbody></table>';
            }

            if (data.surveys && data.surveys.length > 0) {
                html += '<h2 style="margin-top: 20px;">Survey Responses</h2>';
                html += '<table style="width: 100%; border-collapse: collapse;"><thead>';
                html += '<tr><th style="border: 1px solid #ddd; padding: 8px;">Date</th><th style="border: 1px solid #ddd; padding: 8px;">Accuracy</th><th style="border: 1px solid #ddd; padding: 8px;">Stock-outs</th><th style="border: 1px solid #ddd; padding: 8px;">Performance</th></tr>';
                html += '</thead><tbody>';
                data.surveys.forEach(survey => {
                    html += `<tr><td style="border: 1px solid #ddd; padding: 8px;">${survey.date}</td><td style="border: 1px solid #ddd; padding: 8px;">${survey.q1}/5</td><td style="border: 1px solid #ddd; padding: 8px;">${survey.q2}</td><td style="border: 1px solid #ddd; padding: 8px;">${survey.q3}/5</td></tr>`;
                });
                html += '</tbody></table>';
            }

            element.innerHTML = html;

            const opt = {
                margin: 10,
                filename: 'inventory-survey-export.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };

            html2pdf().set(opt).from(element).save();
            showAlert('Data exported to PDF successfully!', 'success');
        }

        function exportToJSON() {
            const data = getExportData();
            const json = JSON.stringify(data, null, 2);
            downloadFile(json, 'inventory-survey-export.json', 'application/json');
            showAlert('Data exported to JSON successfully!', 'success');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // ============== DASHBOARD FUNCTIONS ==============
        function updateDashboard() {
            const totalItems = DB.inventory.length;
            const inventoryValue = DB.inventory.reduce((sum, i) => sum + (i.quantity * i.price), 0);
            const lowStockCount = DB.inventory.filter(i => i.reorderLevel > 0 && i.quantity <= i.reorderLevel).length;
            const surveyCount = DB.surveys.length;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('inventoryValue').textContent = '$' + inventoryValue.toFixed(2);
            document.getElementById('lowStockCount').textContent = lowStockCount;
            document.getElementById('surveyCount').textContent = surveyCount;

            // Quick stats
            const categories = new Set(DB.inventory.map(i => i.category)).size;
            const avgPrice = totalItems > 0 ? (DB.inventory.reduce((sum, i) => sum + i.price, 0) / totalItems).toFixed(2) : 0;
            const locations = new Set(DB.inventory.map(i => i.location)).size;
            const lastSurvey = DB.surveys.length > 0 ? new Date(DB.surveys[DB.surveys.length - 1].timestamp).toLocaleString() : 'Never';

            document.getElementById('totalCategories').textContent = categories;
            document.getElementById('avgPrice').textContent = '$' + avgPrice;
            document.getElementById('locationsCount').textContent = locations;
            document.getElementById('lastSurvey').textContent = lastSurvey;

            // Recent activity
            const activityHtml = DB.activities.slice(0, 10).map(activity => `
                <div style="padding: 10px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between;">
                    <span>${activity.message}</span>
                    <span style="color: var(--text-light); font-size: 12px;">${activity.timestamp}</span>
                </div>
            `).join('');

            document.getElementById('recentActivity').innerHTML = activityHtml || '<p style="color: var(--text-light);">No activities yet</p>';
        }

        // ============== DATA MANAGEMENT ==============
        function loadSampleData() {
            if (DB.inventory.length > 0 || DB.surveys.length > 0) {
                if (!confirm('Sample data will be added to existing data. Continue?')) return;
            }

            DB.inventory.push(
                { id: 1, sku: 'LAP-001', name: 'Dell XPS 13 Laptop', category: 'Electronics', quantity: 15, price: 1299.99, location: 'Shelf A1', reorderLevel: 5, notes: 'High performance ultrabook', createdAt: new Date().toISOString() },
                { id: 2, sku: 'DESK-002', name: 'Standing Desk', category: 'Furniture', quantity: 8, price: 499.99, location: 'Shelf B1', reorderLevel: 3, notes: 'Electric adjustable height', createdAt: new Date().toISOString() },
                { id: 3, sku: 'MOUSE-003', name: 'Wireless Mouse', category: 'Electronics', quantity: 45, price: 29.99, location: 'Bin C1', reorderLevel: 20, notes: 'Ergonomic design', createdAt: new Date().toISOString() },
                { id: 4, sku: 'PEN-004', name: 'Ballpoint Pens (Box of 50)', category: 'Supplies', quantity: 12, price: 15.99, location: 'Shelf D1', reorderLevel: 5, notes: 'Blue ink, medium point', createdAt: new Date().toISOString() },
                { id: 5, sku: 'CHAIR-005', name: 'Office Chair Pro', category: 'Furniture', quantity: 20, price: 349.99, location: 'Shelf B2', reorderLevel: 8, notes: 'Ergonomic lumbar support', createdAt: new Date().toISOString() }
            );

            const today = new Date();
            for (let i = 4; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                DB.surveys.push({
                    id: 100 + i,
                    q1: (Math.floor(Math.random() * 3) + 3).toString(),
                    q2: ['yes', 'no', 'partial'][Math.floor(Math.random() * 3)],
                    q3: (Math.floor(Math.random() * 3) + 3).toString(),
                    comments: 'Regular daily survey submission',
                    timestamp: date.toISOString(),
                    date: date.toLocaleDateString()
                });
            }

            addActivity('Sample data loaded', 'success');
            saveDB();
            showAlert('Sample data loaded successfully! Refresh the page to see updates.', 'success');
        }

        function clearAllData() {
            if (confirm('This will permanently delete ALL data. Are you sure?')) {
                DB.inventory = [];
                DB.surveys = [];
                DB.activities = [];
                localStorage.removeItem('inventorySurveyDB');
                updateDashboard();
                renderInventoryTable();
                renderSurveyList();
                showAlert('All data cleared!', 'success');
            }
        }

        // ============== INITIALIZE ==============
        window.addEventListener('DOMContentLoaded', function() {
            initializeDB();
            updateDashboard();
            renderInventoryTable();
            renderSurveyList();

            // Set default dates for export
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            document.getElementById('exportFromDate').valueAsDate = thirtyDaysAgo;
            document.getElementById('exportToDate').valueAsDate = today;
        });

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
